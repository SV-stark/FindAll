import { Button, ScrollView } from "std-widgets.slint";
import { Palette } from "../globals.slint";

export component PreviewPane inherits Rectangle {
    in property <string> file_name;
    in property <string> file_path;
    in property <string> content;
    in property <image> preview_image;
    in property <string> file_type: "text"; // "text", "image", "binary", "none"
    in property <string> file_size;
    in property <string> modified;
    callback open_file();
    callback open_folder();
    callback copy_path();
    background: Palette.current.surface_color;
    
    // Left border
    Rectangle {
        x: 0;
        width: 1px;
        background: Palette.current.border_color;
    }

    VerticalLayout {
        padding: 16px;
        spacing: 12px;
        
        // Header
        VerticalLayout {
            spacing: 4px;
            Text {
                text: file_name;
                font-size: 16px;
                font-weight: 600;
                overflow: elide;
                color: Palette.current.text_primary;
            }

            Text {
                text: file_path;
                font-size: 11px;
                color: Palette.current.text_secondary;
                overflow: elide;
            }
        }

        Rectangle {
            height: 1px;
            background: Palette.current.border_color;
        }
        
        // Content
        Rectangle {
            vertical-stretch: 1;
            clip: true;
            background: Palette.current.bg_color;
            border-radius: 4px;
            border-color: Palette.current.border_color;
            border-width: 1px;
            if file_type == "text": ScrollView {
                viewport-width: txt.preferred-width;
                viewport-height: txt.preferred-height;
                txt := Text {
                    text: content;
                    font-size: 12px;
                    font-family: "Consolas"; // Or monospace
                    color: Palette.current.text_primary;
                    wrap: word-wrap;
                }
            }
            if file_type == "image": Image {
                source: preview_image;
                image-fit: contain;
            }
            if file_type == "binary" || file_type == "none": VerticalLayout {
                alignment: center;
                Text {
                    text: "No preview available";
                    horizontal-alignment: center;
                    color: Palette.current.text_secondary;
                }
            }
        }
        
        // Metadata
        HorizontalLayout {
            spacing: 16px;
            Text {
                text: "Size: " + file_size;
                font-size: 11px;
                color: Palette.current.text_secondary;
            }

            Text {
                text: "Modified: " + modified;
                font-size: 11px;
                color: Palette.current.text_secondary;
            }
        }
        
        // Actions
        HorizontalLayout {
            spacing: 8px;
            Button {
                text: "Open";
                clicked => {
                    open_file();
                }
            }

            Button {
                text: "Open Folder";
                clicked => {
                    open_folder();
                }
            }

            Button {
                text: "Copy Path";
                clicked => {
                    copy_path();
                }
            }
        }
    }
}
